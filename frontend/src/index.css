@import 'tailwindcss';

@custom-variant dark (&:is(.dark *));

@theme {
  --color-primary-50: #eff6ff;
  --color-primary-100: #dbeafe;
  --color-primary-200: #bfdbfe;
  --color-primary-300: #93c5fd;
  --color-primary-400: #60a5fa;
  --color-primary-500: #3b82f6;
  --color-primary-600: #2563eb;
  --color-primary-700: #1d4ed8;
  --color-primary-800: #1e40af;
  --color-primary-900: #1e3a8a;

  --color-accent-50: #f0fdfa;
  --color-accent-100: #ccfbf1;
  --color-accent-200: #99f6e4;
  --color-accent-300: #5eead4;
  --color-accent-400: #2dd4bf;
  --color-accent-500: #14b8a6;
  --color-accent-600: #0d9488;
  --color-accent-700: #0f766e;
  --color-accent-800: #115e59;
  --color-accent-900: #134e4a;

  --animate-fade-in: fadeIn 0.3s ease-out;
  --animate-slide-up: slideUp 0.3s ease-out;
  --animate-slide-down: slideDown 0.3s ease-out;
  --animate-scale-in: scaleIn 0.2s ease-out;
  --animate-flip: flip 0.6s ease-in-out;
  --animate-shake: shake 0.5s cubic-bezier(.36, .07, .19, .97) both;

  --backdrop-blur-xs: 2px;

  @keyframes fadeIn {
    0% {
      opacity: 0;
    }

    100% {
      opacity: 1;
    }
  }

  @keyframes slideUp {
    0% {
      transform: translateY(10px);
      opacity: 0;
    }

    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes slideDown {
    0% {
      transform: translateY(-10px);
      opacity: 0;
    }

    100% {
      transform: translateY(0);
      opacity: 1;
    }
  }

  @keyframes scaleIn {
    0% {
      transform: scale(0.95);
      opacity: 0;
    }

    100% {
      transform: scale(1);
      opacity: 1;
    }
  }

  @keyframes flip {
    0% {
      transform: rotateY(0deg);
    }

    100% {
      transform: rotateY(180deg);
    }
  }

  @keyframes shake {

    10%,
    90% {
      transform: translate3d(-1px, 0, 0);
    }

    20%,
    80% {
      transform: translate3d(2px, 0, 0);
    }

    30%,
    50%,
    70% {
      transform: translate3d(-4px, 0, 0);
    }

    40%,
    60% {
      transform: translate3d(4px, 0, 0);
    }
  }
}

/*
  The default border color has changed to `currentcolor` in Tailwind CSS v4,
  so we've added these compatibility styles to make sure everything still
  looks the same as it did with Tailwind CSS v3.

  If we ever want to remove these styles, we need to add an explicit border
  color utility to any element that depends on these defaults.
*/
@layer base {

  *,
  ::after,
  ::before,
  ::backdrop,
  ::file-selector-button {
    border-color: var(--color-gray-200, currentcolor);
  }
}

/* Glassmorphism components */
@utility glass-card {
  @apply bg-white/80 dark:bg-slate-800/80 backdrop-blur-xl border border-white/20 dark:border-slate-700/50 rounded-2xl shadow-xl shadow-slate-200/50 dark:shadow-slate-900/50;
}

@utility glass-sidebar {
  @apply bg-slate-50/90 dark:bg-slate-900/90 backdrop-blur-xl border-r border-slate-200/50 dark:border-slate-700/50;
}

@utility btn-primary {
  @apply bg-linear-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white font-medium px-6 py-2.5 rounded-xl shadow-lg shadow-primary-500/30 hover:shadow-primary-500/50 transition-all duration-200 transform hover:scale-[1.02] active:scale-[0.98];
}

@utility btn-secondary {
  @apply bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 text-slate-700 dark:text-slate-200 font-medium px-6 py-2.5 rounded-xl transition-all duration-200;
}

@utility btn-accent {
  @apply bg-linear-to-r from-accent-500 to-accent-600 hover:from-accent-600 hover:to-accent-700 text-white font-medium px-6 py-2.5 rounded-xl shadow-lg shadow-accent-500/30 hover:shadow-accent-500/50 transition-all duration-200;
}

@utility input-field {
  @apply w-full px-4 py-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:border-primary-500 focus:ring-2 focus:ring-primary-500/20 placeholder:text-slate-400 dark:placeholder:text-slate-500 transition-all duration-200 outline-hidden;
}

@utility nav-item {
  @apply flex items-center gap-3 px-4 py-3 rounded-xl text-slate-600 dark:text-slate-400 hover:bg-slate-100 dark:hover:bg-slate-800 hover:text-primary-600 dark:hover:text-primary-400 transition-all duration-200 cursor-pointer;

  &.active {
    @apply bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 font-medium;
  }
}

@utility active {
  &.nav-item {
    @apply bg-primary-50 dark:bg-primary-900/30 text-primary-600 dark:text-primary-400 font-medium;
  }
}

@utility hide-scrollbar {
  -ms-overflow-style: none;
  scrollbar-width: none;
  &::-webkit-scrollbar {
    display: none;
  }
}

@utility flip-card {
  /* Word card flip animation */
  perspective: 1000px;

  &.flipped .flip-card-inner {
    transform: rotateY(180deg);
  }
}

@utility flip-card-inner {
  transition: transform 0.6s;
  transform-style: preserve-3d;

  .flip-card.flipped & {
    transform: rotateY(180deg);
  }
}

@utility flipped {
  &.flip-card .flip-card-inner {
    transform: rotateY(180deg);
  }
}

@utility flip-card-front {
  backface-visibility: hidden;
}

@utility flip-card-back {
  backface-visibility: hidden;
  transform: rotateY(180deg);
}

@utility backface-hidden {
  backface-visibility: hidden;
}

/* Custom base styles */
@layer base {
  :root {
    --bg-primary: #ffffff;
    --bg-secondary: #f8fafc;
    --bg-card: #ffffff;
    --text-primary: #1e293b;
    --text-secondary: #64748b;
    --border-color: #e2e8f0;

    /* Apply base styles to root for View Transition support */
    background-color: var(--bg-primary);
    color: var(--text-primary);
    color-scheme: light;
  }

  .dark {
    --bg-primary: #0f172a;
    --bg-secondary: #1e293b;
    --bg-card: #1e293b;
    --text-primary: #f1f5f9;
    --text-secondary: #94a3b8;
    --border-color: #334155;
    color-scheme: dark;
  }

  body {
    /* Background is now handled by :root */
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    margin: 0;
    min-height: 100vh;
  }
}

/* Scrollbar styling */
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

::-webkit-scrollbar-track {
  @apply bg-transparent;
}

::-webkit-scrollbar-thumb {
  @apply bg-slate-300 dark:bg-slate-600 rounded-full;
}

::-webkit-scrollbar-thumb:hover {
  @apply bg-slate-400 dark:bg-slate-500;
}

/* Heatmap SVG cell - 纯 CSS hover 效果，无 JavaScript */
.heatmap-svg-cell {
  cursor: pointer;
  transition: filter 0.15s ease;
}

.heatmap-svg-cell:hover {
  filter: brightness(1.2);
}

/* Theme Transition Animations */
.circular-transition::view-transition-old(root),
.circular-transition::view-transition-new(root) {
  animation: none;
  mix-blend-mode: normal;
}

/* 
  CRITICAL FIX: Disable all CSS transitions during the theme switch.
  This ensures the "New" snapshot captures the FINAL state immediately,
  instead of capturing a "fading" state which would look like the old theme.
  INCLUDE PSEUDO-ELEMENTS to ensure no sub-element transitions persist.
*/
.circular-transition *,
.circular-transition *::before,
.circular-transition *::after {
  transition: none !important;
}

/* Z-index management */
::view-transition-old(root) {
  z-index: 1;
}

::view-transition-new(root) {
  z-index: 9999;
}

/* Dark mode z-index override removed: New snapshot should always be on top for expanding animation */